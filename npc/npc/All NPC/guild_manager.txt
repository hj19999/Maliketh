prontera,159,180,3	script	Guild Manager	NPC_SPRITE,{

	set .name$, "^EA8B1CGuild Manager^000000";;
    
	mes .name$;
    mes "Hello, "+strcharinfo(0)+".";
    mes "What can I do for you?";
	next;
    menu "Create a Guild",-,"Transfer Guild Leadership",L_Transfer;
	if( getcharid(2) != 0 ) goto L_Warning;
    mes .name$;
    mes "Please name your Guild.";
	mes "^DD0000(Maximum Char. 23)^000000";
    sleep2 1500;
	goto L_Create2;

L_Create2:
    input @gcreatenm$;
    mes ""+@gcreatenm$+"?";
	menu "Yes",-,"No",L_Create2;
	
    atcommand "@guild "+@gcreatenm$;
    sleep2 250;
    if(getcharid(2) == 0) { mes "Guild creation was unsuccessful. Please, try another name."; goto L_Create2; }
    announce strcharinfo(0)+" has banded the [ "+strcharinfo(2)+" ] Guild.",bc_all,0xEEEEEE;
    mes "Guild creation was successful.";
    close;
    end;

L_Transfer:
	if( !getcharid(2) ){
	mes "You are not in a Guild."; close2; end;}
	
	if( strcharinfo(0) != getguildmaster(getcharid(2)) ) {
	mes "You need to be the Guild Master of the Guild if you want to transfer leadership.";
	close2;
	end;
	}

	mes "Enter the name of the player that you wish to be the new Guild Master.";
	next;
	goto L_Transfer2;

L_Transfer2:	
	input .@newgm$;
	if (!query_sql("SELECT `name` FROM `char` WHERE `name` = '"+escape_sql(.@newgm$)+"' AND `guild_id` = "+getcharid(2)+" AND `online` = 1",.@ignore$)) {
	mes .name$;
	mes "The character name '"+.@newgm$+"' is invalid, either they don't exist, are off-line, or are not in your Guild.";
	next;
	menu "Try Again",L_Transfer2;
	end;
	}
	mes .name$;
	mes ""+.@newgm$+" will be the new Guild Master of [ "+getguildname(getcharid(2))+" ] ?";
	menu "Yes",-,"No",L_Transfer2;

	atcommand "@changegm "+.@newgm$;
	sleep2 250;
	if (getguildmasterid(getcharid(2)) != getcharid(0)) {
	mes "Guild Leadership transferred successfully!";
	close;
	end;
	}
	mes "Guild Leadership transfer was not successful.";
	close;
	end;
	
	
L_Warning2:
	mes .name$;
    mes "You are lacking the necessary funds to create a Guild.";
    close;

L_Warning:
	mes .name$;
    mes "You are already in a Guild.";
    close;
	
}