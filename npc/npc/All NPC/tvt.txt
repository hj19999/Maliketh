-	script	TvTSetting	-1,{
OnInit:

	setarray $TvTMap$[0], "ordeal_2-2";
	setarray $TvTItemID[0], 7227, 7439;
	setarray $TvTItemCount[0], 50, 10;
	setarray $TvTCoordinates[0], 130, 192, 105, 153; //Координаты для варпа команд.
	
	// --- conf --- //	
	set $TvTName$, "^FF0000[Team vs Team]^000000";
	set $TvTEvent$, "Team vs Team";
	// --------------------------- //
	set $RedTeam$, ""; // -------- //
	set $BlueTeam$, ""; // ------- //
	// --------------------------- //
	set $RedTvT, 0; // ----------- //
	set $BlueTvt, 0; // ---------- //
	// --------------------------- //
	set $TvTStart, 0; // --------- //
	set $TvTMinLevel, 99; // ----- //
	//disablenpc "TvT Event"; // --- //
	setcell ""+$TvTMap$[0]+"",116,198,120,203,cell_walkable,0;
	setcell ""+$TvTMap$[0]+"",93,140,98,138,cell_walkable,0;
	set $RR, 0;
	set $BB, 0;
	end;
}

function	script	WinnerTvTRed	{
mapannounce ""+$TvTMap$[0]+"","Красная команда победила!",bc_map;
//getitem_map 7227,10,strcharinfo(3),RedTeam,4;
for(set .kkk,0; .kkk <= getarraysize($BlueTeam$) && .kkk <= getarraysize($RedTeam$); set .kkk, .kkk +1)
{
		warpchar ""+$TvTMap$+"",$TvTCoordinates[2],$TvTCoordinates[3],$BlueTeam$[.kkk];
		warpchar ""+$TvTMap$+"",$TvTCoordinates[0],$TvTCoordinates[1],$RedTeam$[.kkk];
}
killmonsterall ""+$TvTMap$+"";
sleep 1800000;
deletearray $RedTeam$[0],getarraysize($RedTeam$);
deletearray $BlueTeam$[0],getarraysize($BlueTeam$);
end;
}

function	script	WinnerTvTBlue	{
mapannounce ""+$TvTMap$[0]+"","Синяя команда победила!",bc_map;
//getitem_tvt 7227,10,strcharinfo(3),RedTeam,4;
for(set .kkk,0; .kkk <= getarraysize($BlueTeam$) && .kkk <= getarraysize($RedTeam$); set .kkk, .kkk +1)
{
		warpchar ""+$TvTMap$+"",$TvTCoordinates[2],$TvTCoordinates[3],$BlueTeam$[.kkk];
		warpchar ""+$TvTMap$+"",$TvTCoordinates[0],$TvTCoordinates[1],$RedTeam$[.kkk];
}
killmonsterall ""+$TvTMap$+"";
sleep 1800000;
deletearray $RedTeam$[0],getarraysize($RedTeam$);
deletearray $BlueTeam$[0],getarraysize($BlueTeam$);
end;
}

function	script	EndTvT	{
	set $RedTeam$, "";
	set $BlueTeam$, "";
	set $RedTvT, 0; 
	set $BlueTvt, 0; 
	set $TvTStart, 0; 
	set $TvTMinLevel, 99;
	disablenpc "TvT Event"; 
	setcell ""+$TvTMap$[0]+"",116,198,120,203,cell_walkable,0;
	setcell ""+$TvTMap$[0]+"",93,140,98,138,cell_walkable,0;
	set $RR, 0;
	set $BB, 0;
	mapwarp ""+$TvTMap$[0]+"","prontera",150,150;
	end;
}
	

-	script	GuardianStone	-1,{
OnKillMonster:
end;
}
		
-	script	TvTEventStart	-1,{
OnClock0000:

		announce "[TvT] : Эвент начнеться через 5 минут, все кто желает, могут зарегистрироваться в пронтере!",bc_all;
		set $TvTStart, 1;
		enablenpc "TvT Event";
		sleep 300000;
		if(getarraysize($RedTeam$) < 5 || getarraysize($BlueTeam) < 5) 
		{
				callfunc "EndTvT";
		}
		else
		
		if(getmapusers("+$TvTMap$[0]+") < 10)
		{
				callfunc "EndTvT";
		}
		else
		disablenpc "TvT Event";
		announce "[TvT] : Эвент успешно стартовал.Удачной игры.",bc_all;
		setcell ""+$TvTMap$[0]+"",116,198,120,203,cell_walkable,1;
		setcell ""+$TvTMap$[0]+"",93,140,98,138,cell_walkable,1;
		initnpctimer;
		end;
		
		
		OnTimer30000:
		if(getmapusers("+$TvTMap$[0]+") < 10)
		{
				if(getarraysize($RedTeam$) < 5)
				{
						for(set .k,0; .k <= getarraysize($BlueTeam$) && .k <= getarraysize($RedTeam$); set .k, .k +1)
						{
								warpchar ""+$TvTMap$+"",$TvTCoordinates[2],$TvTCoordinates[3],$BlueTeam$[.k];
								warpchar ""+$TvTMap$+"",$TvTCoordinates[0],$TvTCoordinates[1],$RedTeam$[.k];
						}
						
						set $RR, getarraysize($RedTeam$);
						end;
				}
				else if(getarraysize($BlueTeam) < 5)
				{
						for(set .k,0; .k <= getarraysize($BlueTeam$) && .k <= getarraysize($RedTeam$); set .k, .k +1)
						{
								warpchar ""+$TvTMap$+"",$TvTCoordinates[2],$TvTCoordinates[3],$BlueTeam$[.k];
								warpchar ""+$TvTMap$+"",$TvTCoordinates[0],$TvTCoordinates[1],$RedTeam$[.k];
						}
						
						set $BB, getarraysize($BlueTeam$);	
						end;
				}
		}
		else
		{
				
		
				OnPCDieEvent:
				OnPCLogoutEvent:
				
				getmapxy $TvTMapa$,$X,$Y,0;
				
				if($TvTMapa$ == $TvTMap$[0])
				{
						if(getarraysize($RedTeam) != 0 && getarraysize($BlueTeam$) != 0 && $TvTStart != 0)
						{
								for(set .d,0; .d <= getarraysize($RedTeam$) && .d <= getarraysize($BlueTeam$); set .d,.d + 1)
								{
										if(strcharinfo(0) == $RedTeam$[.d])
										{
												warpchar ""+$TvTMap$+"",$TvTCoordinates[0],$TvTCoordinates[1],$RedTeam$[.d];
												end;
										}
										else if(strcharinfo(0) == $BlueTeam$[.d])
										{
												warpchar ""+$TvTMap$+"",$TvTCoordinates[2],$TvTCoordinates[3],$BlueTeam$[.d];
												end;
										}
								}
						}
						
						warp "SavePoint",0,0;
				}
				
				OnPCKillEvent:
				
				getmapxy $TvTMaps$,$X,$Y,0;
				
				if($TvTMaps$ == $TvTMap$[0])
				{
						if($BPoint > 999)
						{
								callfunc "WinnerTvTBlue";
								stopnpctimer;
						}
						else if($RPoint > 999)
						{
								callfunc "WinnerTvTRed";
								stopnpctimer;
						}
						for(set .rr,0; .rr <= getarraysize($RedTeam) && .rr <= getarraysize($BlueTeam$); set .rr,.rr + 1)
						{
								if(strcharinfo(0) == $RedTeam$[.rr])
								{
										attachrid killedrid;
										set $RPoint,$RPoint + 1;
										mapannounce ""+$TvTMaps$+"",""+rid2name(killerrid)+" завалил ["+ strcharinfo(0) +"] с синей команды!!",bc_map;
								}
								else if(strcharinfo(0) == $BlueTeam$[.rr])
								{
										attachrid killedrid;
										set $BPoint , $BPoint + 1;
										mapannounce ""+$TvTMaps$+"",""+rid2name(killerrid)+" завалил ["+ strcharinfo(0) +"] с красной команды!!",bc_map;
								}
						}
						end;
				}
				end;
		
		}
}




// --- Регистрация : --- //
// --- T     v     T --- //
// --------------------- //
prontera,151,173,6	script	TvT Event	999,{
if(!$TvTStart) close;

switch(rand(1,2))
{
		case 1:
		if(BlueTeam) close;
		mes $TvTName$;
		if(BaseLevel < $TvTMinLevel)
		{
				mes "Вы должны быть не меньше "+$TvTMinLevel+" что-бы войти";
				close;
		}
		else
		{
				if($RedTvT >= 5) 
				{
						mes "Извините, но 5 игроков уже зарегистрировалось.";
						close;
				}
				// ---------
				if(RedTeam == 1) close;
				set $RedTeam$[getarraysize($RedTeam$)], strcharinfo(0);
				set $RedTvT,$RedTvT + 1;
				set RedTeam, 1;
				warp "bat_b01",0,0;
				dispbottom "Ждите начала игры.";
				announce "[TvT] : "+strcharinfo(0)+" зарегистрировался на TvT. ["+$RedTvT+"/5] игроков зарегистрировались.",bc_all;
				if($RedTvT >= 5 && $TvTStart == 1)
				{
						for(set .r,0; .r <= getarraysize($RedTeam$); set .r,.r + 1)
						{
								warpchar ""+$TvTMap$+"",$TvTCoordinates[0],$TvTCoordinates[1],$RedTeam$[.r];
						}
				}
								
						
		}
		close;
		
		case 2:
		mes $TvTName$;
		if(RedTeam) close;
		if(BaseLevel < $TvTMinLevel)
		{
				mes "Вы должны быть не меньше "+$TvTMinLevel+" что-бы войти";
				close;
		}
		else
		{
				if($BlueTvT >= 5) 
				{
						mes "Извините, но 5 игроков уже зарегистрировалось.";
						close;
				}
				// ---------
				if(BlueTeam == 1) close;
				set $BlueTeam$[getarraysize($BlueTeam$)], strcharinfo(0);
				set $BlueTvT, $BlueTvT + 1;
				set BlueTeam, 1;
				warp "bat_b01",0,0;
				dispbottom "Ждите начала игры.";
				announce "[TvT] : "+strcharinfo(0)+" зарегистрировался на TvT. ["+$BlueTvT+"/5] игроков зарегистрировались.",bc_all;
				if($BlueTvT >= 5 && $TvTStart == 1)
				{
						for(set .b,0; .b <= getarraysize($BlueTeam$); set .b,.b + 1)
						{
								warpchar ""+$TvTMap$+"",$TvTCoordinates[2],$TvTCoordinates[3],$BlueTeam$[.b];
						}
				}
				close;
		}
}	
}		
	